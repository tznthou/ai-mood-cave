# AI心情樹洞 - 專案企劃書

## 專案概述

**專案名稱：** AI心情樹洞  
**開發技術：** HTML、JavaScript、Tailwind CSS  
**學習目標：** 情感AI、隱私保護、實時通訊、心理健康演算法  
**開發週期：** 預估 8-12 週

## 問題分析

### 痛點識別
現代人面臨巨大生活壓力，但缺乏合適的情感出口：
- 心理諮詢門檻高、費用昂貴
- 對朋友家人不願透露真實情感
- 社交媒體缺乏真正的情感支持
- 24/7情感危機時刻缺乏即時幫助

### 目標用戶
- **主要群體：** 全年齡段有情感支持需求的用戶
- **學生族群：** 課業壓力、人際關係困擾
- **上班族：** 工作壓力、生活平衡問題
- **家長：** 育兒焦慮、家庭責任壓力
- **銀髮族：** 健康擔憂、孤獨感
- **特殊狀況：** 失業、失戀、喪親等特殊時期用戶

## 產品功能設計

### 核心功能（MVP）
1. **匿名心情日記**
   - 簡潔的文字輸入介面
   - 情緒標籤快速選擇
   - 當下心情強度評分

2. **智能情感分析**
   - 關鍵字情感識別
   - 情緒分類（焦慮、憂鬱、憤怒、快樂等）
   - 情感強度評估

3. **個人化AI回應**
   - 多種回應風格選擇
   - 溫暖陪伴型、專業分析型、朋友聊天型等
   - 即時情感回饋

4. **基礎記錄展示**
   - 心情曲線圖
   - 情感關鍵字雲
   - 簡單的趨勢分析

### 進階功能
5. **個人化建議系統**
   - 基於情感分析的個人化建議
   - 冥想和放鬆練習推薦
   - 情緒管理技巧分享

6. **心理健康趨勢分析**
   - 個人情緒波動分析
   - 壓力源識別
   - 改善建議追蹤

7. **社群匿名互助**
   - 匿名情感分享區
   - 同理心回應機制
   - 正能量傳遞系統

8. **危機預警系統**
   - 情緒危機識別
   - 專業資源推薦
   - 緊急求助管道

## 技術架構

### 前端技術棧
- **HTML5：** 語義化結構
- **JavaScript ES6+：** 邏輯處理
- **Tailwind CSS：** 響應式設計
- **Local Storage/IndexedDB：** 本地數據存儲

### 後端技術棧
- **Node.js：** 服務器運行環境
- **Express.js：** Web 應用框架
- **Helmet：** 安全中間件
- **CORS：** 跨域資源共享
- **Rate Limiting：** 請求速率限制
- **dotenv：** 環境變數管理

### 安全架構
- **API 代理：** 前端不直接調用外部 API
- **環境變數：** 敏感配置服務器端保護
- **速率限制：** 防止 API 濫用
- **CORS 配置：** 限制跨域訪問
- **請求日誌：** 監控和調試

### 專案檔案架構

```
05 AI 心情樹洞/
├── index.html                    # 主頁面
├── server.js                     # Node.js 後端代理服務器
├── package.json                  # Node.js 專案配置
├── .env                          # 環境變數配置（敏感資料）
├── env.example                   # 環境變數範例
├── .gitignore                    # Git 忽略文件
├── js/
│   ├── main.js                   # 主應用程式入口
│   └── modules/                  # 功能模組目錄
│       ├── ai.js                 # AI 回應處理
│       ├── aiService.js          # AI API 服務（後端代理）
│       ├── chart.js              # 圖表功能
│       ├── config.js             # 配置設定
│       ├── events.js             # 事件處理
│       ├── greeting.json         # 問候語資料
│       ├── state.js              # 狀態管理
│       ├── storage.js            # 資料儲存
│       ├── ui.js                 # 用戶界面
│       └── utils.js              # 工具函數
├── node_modules/                 # Node.js 依賴包
├── README.md                     # 專案說明文件
├── USER_MANUAL.md               # 使用者手冊
└── Tailwind 設計風格指南.md     # 設計指南
```

## 部署指南

### 環境需求
- Node.js 14.0.0 或更高版本
- npm 或 yarn 套件管理器
- DeepBricks AI API 金鑰

### 安裝步驟

1. **複製專案**
   ```bash
   git clone [repository-url]
   cd "05 AI 心情樹洞"
   ```

2. **安裝依賴**
   ```bash
   npm install
   ```

3. **配置環境變數**
   ```bash
   cp env.example .env
   # 編輯 .env 文件，填入實際的 API 金鑰
   ```

4. **啟動服務器**
   ```bash
   npm start
   ```

5. **訪問應用**
   - 打開瀏覽器訪問 `http://localhost:3001`
   - 後端 API 運行在 `http://localhost:3001/api`

### 開發模式
```bash
npm run dev  # 使用 nodemon 自動重啟
```

### 環境變數說明
```env
DEEPBRICKS_API_KEY=your_api_key_here    # DeepBricks AI API 金鑰
AI_MODEL=gpt-4o                         # AI 模型名稱
AI_MAX_TOKENS=1000                      # 最大回應長度
AI_TEMPERATURE=0.7                      # 創造性參數
PORT=3001                               # 服務器端口
FRONTEND_URL=http://localhost:3000      # 前端地址（CORS）
NODE_ENV=development                    # 環境模式
```

### 安全注意事項
- 🔒 **絕不** 將 `.env` 文件提交到版本控制
- 🔑 定期更換 API 金鑰
- 🛡️ 在生產環境中設置適當的 CORS 配置
- 📊 監控 API 使用量和錯誤日誌
- 🚫 限制服務器訪問權限

### 隱私保護機制
- **用後即焚：** 24小時自動刪除所有數據
- **本地存儲：** 敏感信息僅存於用戶設備
- **匿名化：** 無用戶識別信息收集
- **加密傳輸：** API調用數據加密
- **服務器端保護：** API 金鑰不暴露於前端

### AI整合方案
**方案A - 完全本地（高隱私）：**
- 關鍵字情感分析
- 預設回應模板
- 規則引擎

**方案B - 混合模式（平衡隱私與功能）：**
- 基礎分析本地處理
- 複雜情感分析API調用
- 匿名化數據傳輸

**方案C - 雲端AI（最佳體驗）：**
- OpenAI/Claude API
- 實時情感分析
- 個人化回應生成

## 用戶體驗設計

### 介面設計原則
- **簡潔直觀：** 降低使用門檻
- **情感化設計：** 溫暖色調、友善圖標
- **響應式：** 適配各種設備
- **無障礙：** 考慮視障、聽障用戶需求

### 回應風格選擇
1. **溫暖陪伴型：** "我理解你的感受，你並不孤單..."
2. **專業分析型：** "從心理學角度來看，這種情況..."
3. **朋友聊天型：** "哇，這確實蠻煩的耶，我懂你..."
4. **導師指導型：** "讓我們一起找找解決方法..."
5. **冥想靜心型：** "讓我們先深呼吸，放鬆一下..."

## 開發計劃

### 第一階段（週 1-3）：MVP 開發
- 基礎介面設計
- 文字輸入與簡單回應
- 本地存儲實現
- 關鍵字情感分析

### 第二階段（週 4-6）：功能擴展
- AI回應風格選擇
- 心情記錄與圖表展示
- 響應式設計優化
- 隱私保護機制

### 第三階段（週 7-9）：進階功能
- 個人化建議系統
- 冥想內容整合
- 社群功能設計
- 危機預警機制

### 第四階段（週 10-12）：測試與優化
- 用戶測試
- 性能優化
- 安全性檢查
- 功能完善

## 學習重點

### 技術學習目標
- **情感AI實現：** 自然語言處理基礎
- **隱私保護：** 數據加密、匿名化技術
- **前端進階：** 複雜狀態管理、用戶體驗設計

---

## 版本變更紀錄

- 0.1.0 (2025-07-20)：初始化專案
- 0.1.1 (2025-07-20)：更新 Zeabur 部署指南，新增 Extension 部署方式說明
- 0.1.2 (2025-07-20)：修復 API 連線問題 - 更新動態 API URL 檢測和 CSP 設定
- **心理健康演算法：** 情緒識別、危機預警

### 軟技能培養
- **同理心設計：** 理解用戶情感需求
- **倫理思考：** 心理健康產品的責任
- **隱私意識：** 數據保護的重要性

## 風險評估

### 技術風險
- AI回應品質可能不穩定
- 隱私保護與功能性平衡困難
- 危機預警準確度挑戰

### 倫理風險
- 可能被誤用作專業心理治療
- 數據隱私洩露風險
- 危機情況處理不當

### 解決方案
- 明確產品定位（情感支持非專業治療）
- 嚴格的隱私保護機制
- 危機時提供專業資源連結

## 成功指標

### 技術指標
- 情感分析準確率 > 75%
- 頁面載入速度 < 2 秒
- 響應式設計覆蓋率 100%
- 數據隱私保護 100% 合規

### 用戶體驗指標
- 用戶滿意度 > 4.0/5.0
- 回訪率 > 30%
- 平均使用時長 > 10 分鐘
- 用戶推薦意願 > 60%

## 結語

「AI心情樹洞」專案旨在為現代人提供一個安全、私密、智能的情感支持平台。通過結合前端技術與情感AI，我們希望能夠創造一個真正有價值的數位心理健康工具，同時在開發過程中深入學習相關技術和設計理念。

此專案不僅是技術學習的絕佳機會，更是對社會有正面影響的有意義專案。

---

## 作者
TznThou

## 建立日期
2025-07-12

## 版本
2.3.3

---

## 版本變更紀錄

- 2.3.3 (2025-07-14)：修正 CORS 導致的 CSS 載入問題
  - 🔧 調整中間件順序，將靜態文件服務移至 CORS 之前
  - 🌐 為靜態文件（CSS、JS）設置專用的 CORS 頭
  - 🛡️ 將 CORS 配置限制僅應用於 API 端點（`/api`）
  - 📁 確保 CSS 和 JS 文件能正確載入，解決 port 3001 版面問題
- 2.3.2 (2025-07-13)：修正跨端口 API 調用問題
  - 🔧 修正 CORS 配置，支援多端口訪問
  - 🌐 新增動態 API URL 檢測，支援不同端口環境
  - 🛡️ 優化 Content Security Policy，添加 'unsafe-eval' 支援 Tailwind
  - 📁 改善靜態文件服務，設置正確的 MIME 類型
  - 🔗 確保 port 3000 和 3001 都能正常工作
- 2.3.1 (2025-07-13)：修正 CSS 樣式問題
  - 🎨 修正深色模式選擇器（從 `.dark` 改為 `html.dark`）
  - 🔧 修正卡片動畫初始化問題，確保內容正確顯示
  - 🖼️ 修正分隔線樣式，添加寬度和居中對齊
  - 🚀 移除內嵌 CSS 中的 `!important` 標記，減少樣式衝突
  - ✨ 優化 `initAnimations()` 函數，確保卡片預設可見
- 2.3.0 (2025-07-13)：實現安全的 AI API 架構
  - 🔒 **重大安全更新**：移除前端 API 金鑰暴露風險
  - 🚀 新增 Node.js 後端代理服務器（`server.js`）
  - 🛡️ 實現 API 金鑰服務器端保護
  - ⚡ 添加速率限制和安全中間件（helmet, cors）
  - 📊 新增請求日誌和錯誤監控
  - 🔧 重構前端 AI 服務調用邏輯
  - 📝 更新 `aiService.js`，改用後端代理 API
  - 🔐 創建環境變數配置（`.env` 文件）
  - 📦 新增 `package.json` 和 Node.js 依賴管理
  - 🛠️ 優化 `.gitignore`，保護敏感配置文件
  - 📋 更新部署和使用說明文檔
- 2.2.0 (2025-07-13)：AI 串接與智能對話功能
  - 成功串接 DeepBricks AI API，實現真正的 AI 智能對話功能。
  - 新增 `aiService.js` 模組，專門處理 AI API 通訊與連線管理。
  - 重構 `ai.js` 模組，整合真實 AI 回應與備用回應機制。
  - 實現 5 種不同的 AI 回應風格：溫暖陪伴型、專業分析型、朋友聊天型、導師指導型、冥想靜心型。
  - 新增 AI 連線測試功能，啟動時自動檢測 AI 服務狀態。
  - 當 AI 服務無法使用時，自動切換到備用回應模板，確保使用者體驗不中斷。
  - 完善的錯誤處理機制，包含詳細的 console 日誌記錄。
  - AI 回應內容針對用戶心情、強度和選擇的風格進行個人化調整。
- 2.1.0 (2025-07-13)：問候語資料分離與 UI/UX 優化
  - 將所有問候語從 `ui.js` 完全分離，獨立存放於 `js/modules/greeting.json`，提升維護性與擴充彈性。
  - `showWelcomeGreeting` 改為動態載入 JSON，支援未來多語系或主題分類。
  - 完善問候語內容，涵蓋溫暖、激勵、幽默、共感等多元情緒，並可隨時擴充。
  - 依據設計規範，持續優化 UI/UX 細節，確保動畫、色彩、互動體驗一致。
- 2.0.0 (2025-07-13)：JavaScript 程式碼模組化重構
  - 依據《程式碼行數最佳實踐規則》，將原有的 800+ 行的 `js/app.js` 進行全面重構。
  - 建立 `js/modules/` 目錄，將程式碼拆分為 `state`, `storage`, `ui`, `ai`, `chart`, `events`, `config` 等多個職責單一的模組。
  - 改用現代化的 ES6 模組 (`import/export`) 進行管理，提升程式碼的可讀性與可維護性。
  - 建立新的主入口檔案 `js/main.js`，負責初始化應用程式。
  - 此次重構大幅改善了專案架構，為未來的擴展和協作奠定了良好基礎。
- 1.6.0 (2025-07-13)：新增深色模式 (Dark Mode)
  - 在「設定」中增加深色模式切換開關，提供更舒適的夜間使用體驗。
  - 使用 Tailwind CSS 的 `dark:` 模式，為所有組件提供對應的深色主題樣式。
  - 使用者對深色模式的偏好會被儲存在本地，下次打開時會自動套用。
  - 心情趨勢圖表會根據當前模式（亮色/深色）自動調整顏色，確保可讀性。
  - 清除資料時會保留使用者的外觀設定。
- 1.5.0 (2025-07-13)：新增心情趨勢圖表
  - 整合 `Chart.js` 圖表庫，實現心情記錄的視覺化。
  - 在「心情記錄」彈窗中增加心情強度趨勢圖，以折線圖展示過去24小時的情緒起伏。
  - 圖表具有響應式設計，並採用了符合整體風格的顏色與漸層效果。
  - 優化無記錄時的提示訊息，引導使用者開始記錄以查看圖表。
- 1.4.0 (2025-07-13)：新增法律免責與使用警語
  - 在頁腳新增「重要聲明與使用警語」連結。
  - 建立一個獨立的警語彈窗，內容包含應用程式的局限性與危機處理建議。
  - 實現首次使用者強制閱讀警語的功能，確保使用者了解後再開始使用。
  - 警語彈窗使用醒目的設計，以強調其重要性。
- 1.3.0 (2025-07-13)：新增頁腳(Footer)
  - 在頁面底部增加一個簡潔的頁腳，包含版權資訊和專案標語。
  - 頁腳風格與整體設計保持一致，提升頁面完整性。
- 1.2.0 (2025-07-13)：新增APP使用說明
  - 建立 `USER_MANUAL.md` 檔案，提供詳細的功能介紹和操作指南。
  - 在主介面新增「幫助」按鈕，方便使用者隨時查閱說明。
  - 實現動態載入說明文件到模態框的功能。
- 1.1.0 (2025-07-12)：根據設計風格指南優化UI/UX
  - 採用溫暖中性色調和療癒色系。
  - 更新字體系統為Inter + Noto Sans TC。
  - 優化間距系統和圓角設計。
  - 改進情緒標籤的視覺設計和色彩分類。
  - 增加卡片出現動畫效果。
  - 優化AI回應區域的視覺層次。
  - 改善載入指示器和按鈕互動效果。
- 1.0.0 (2025-07-12)：完成基礎APP架構建構
  - 建立完整的HTML結構和UI設計。
  - 實現核心JavaScript功能邏輯。
  - 包含情感分析、AI回應生成、本地存儲等功能。
  - 支援5種不同的AI回應風格。
  - 實現24小時自動刪除隱私保護機制。
  - 完成心情記錄、設定管理等功能模組。

---

## 專案檔案架構

```text
AI心情樹洞/
├── index.html                # 主頁，前端UI與結構
├── README.md                 # 專案說明與版本紀錄
├── USER_MANUAL.md            # 使用者操作手冊
├── Tailwind 設計風格指南.md  # UI設計規範與色彩指南
├── 程式碼行數最佳實踐規則.md  # 程式碼結構與行數規範
├── js/
│   ├── main.js               # 應用主入口，初始化所有模組
│   └── modules/
│       ├── config.js         # 靜態設定、AI回應模板、情緒關鍵字、API配置
│       ├── state.js          # 全域狀態管理
│       ├── storage.js        # 本地資料儲存與載入
│       ├── ai.js             # 情感分析與AI回應邏輯整合
│       ├── aiService.js      # AI API 通訊服務（DeepBricks API）
│       ├── chart.js          # 心情趨勢圖表繪製
│       ├── ui.js             # UI顯示、動畫、通知等
│       ├── greeting.json      # 問候語資料庫（溫暖、激勵、幽默等）
│       └── events.js         # 事件綁定與用戶互動邏輯
├── .specstory/
│   ├── .what-is-this.md      # 專案規格說明
│   └── history/              # 專案歷史紀錄
│       └── ...
├── .cursorrules              # AI協作規則
```

**說明：**
- `index.html`：應用主頁，包含所有UI結構與模態框。
- `js/main.js`：應用啟動點，負責載入與初始化所有功能模組。
- `js/modules/`：所有JavaScript功能模組，依職責拆分，易於維護與擴充。
- `js/modules/aiService.js`：AI API 通訊服務，處理與 DeepBricks AI 的所有互動。
- `js/modules/greeting.json`：所有問候語資料，方便擴充與多語系支援。
- `USER_MANUAL.md`：詳細操作說明，會動態載入到說明模態框。
- `Tailwind 設計風格指南.md`：UI設計與色彩規範。
- `程式碼行數最佳實踐規則.md`：團隊程式碼結構與品質標準。
- `.specstory/`：專案規格、歷史紀錄與AI協作相關文件。

---

## 2025-07-14 專案階段總結與後續建議

### 本階段成果總結
- 完成前後端分離的AI心情樹洞應用，支援多種AI回應風格、心情記錄、深色模式、動畫效果、問候語等功能。
- 成功串接 DeepBricks AI API，並以 Node.js 代理後端安全保護金鑰，前端不再暴露敏感資訊。
- 完成 CORS、Content Security Policy、速率限制等安全機制，確保API安全與前端靜態資源正確載入。
- 前端模組化設計，程式碼結構清晰，易於維護與擴充。
- 完善的 README 與 USER_MANUAL，方便新手快速上手。

### 目前架構優缺點
**優點：**
- 架構清晰，前後端分離，安全性高。
- 支援多端口開發（3000/3001），方便本地測試與部署。
- UI/UX 設計現代，支援深色模式與動畫。
- AI 回應風格多元，個人化體驗佳。
- 良好的隱私保護與本地資料管理。

**缺點/限制：**
- AI 回應語言目前僅靠 prompt 控制，無法自動偵測用戶語言。
- 心情記錄與分析僅限本地，無雲端同步或多裝置支援。
- 危機預警、社群互助等進階功能尚未實作。
- 測試覆蓋率與自動化測試尚未建立。
- 尚未有正式的行動裝置PWA支援。

### 可優化/可擴充方向建議
1. **AI語言偵測與多語系支援**：
   - 根據用戶瀏覽器語言自動切換AI回應語言，或提供語言選擇。
   - 問候語、UI、USER_MANUAL 多語系化。
2. **雲端同步與帳號系統**：
   - 支援用戶登入、跨裝置同步心情記錄。
   - 可考慮匿名帳號或OAuth登入。
3. **危機預警與專業資源串接**：
   - 增加情緒危機自動識別，主動推播專業協助資源。
   - 可串接心理諮詢、求助熱線API。
4. **社群互助與匿名分享**：
   - 建立匿名心情分享區，支援留言、互動、正能量傳遞。
5. **PWA與行動裝置優化**：
   - 完善PWA支援，支援離線使用與推播通知。
   - 行動裝置UI/UX細節優化。
6. **自動化測試與CI/CD**：
   - 建立單元測試、端對端測試，提升穩定性。
   - 導入自動化部署流程。
7. **AI回應品質優化**：
   - 支援上下文多輪對話。
   - 增加AI回應評分與學習機制。

---

> 本階段已完成基礎架構與AI串接，建議下階段聚焦於多語系、雲端同步、危機預警與社群互助等功能，並逐步提升產品穩定性與用戶體驗。